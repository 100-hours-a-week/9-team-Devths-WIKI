name: Sync Wiki to Supabase

on:
  # ìˆ˜ë™ íŠ¸ë¦¬ê±°
  workflow_dispatch:
  
  # ìŠ¤ì¼€ì¤„ë§ (5ë¶„ë§ˆë‹¤ ì²´í¬ - Wiki ë³€ê²½ì„ ë¹ ë¥´ê²Œ ê°ì§€)
  schedule:
    - cron: '*/5 * * * *'  # 5ë¶„ë§ˆë‹¤
  
  # repository_dispatch (Wikiì—ì„œ webhookìœ¼ë¡œ íŠ¸ë¦¬ê±° ê°€ëŠ¥)
  repository_dispatch:
    types: [wiki-updated]

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout main repository
        uses: actions/checkout@v4
      
      - name: Checkout Wiki Repository
        uses: actions/checkout@v4
        with:
          repository: 100-hours-a-week/9-team-Devths-WIKI.wiki
          path: wiki
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        working-directory: .github/scripts
        run: npm install
      
      - name: Parse Wiki and Sync to Supabase
        working-directory: .github/scripts
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL || 'https://szqkjeezfptsdxwtypbj.supabase.co' }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY || secrets.SUPABASEKEY }}
          WIKI_PATH: ${{ github.workspace }}/wiki
        run: node sync-wiki-to-supabase.js
        continue-on-error: true
      
      - name: Summary
        if: success()
        run: |
          echo "âœ… Wiki ë™ê¸°í™” ì™„ë£Œ!"
          echo "ğŸ“ Team Blog í˜ì´ì§€ì˜ ê²Œì‹œê¸€ì´ Supabaseì— ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤."
      
      - name: Error Summary
        if: failure()
        run: |
          echo "âŒ Wiki ë™ê¸°í™” ì‹¤íŒ¨"
          echo "ğŸ’¡ GitHub Secretsì— SUPABASE_URLê³¼ SUPABASE_SERVICE_KEYê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”."
