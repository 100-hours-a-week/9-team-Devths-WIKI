name: Wiki Push to Trigger Sync

on:
  # Wiki ì €ì¥ì†Œì— pushê°€ ë°œìƒí•˜ë©´ ë©”ì¸ ì €ì¥ì†Œì˜ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°
  push:
    branches:
      - master  # Wiki ì €ì¥ì†Œì˜ ê¸°ë³¸ ë¸Œëœì¹˜
    paths:
      - '*.md'  # ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ë³€ê²½ ì‹œì—ë§Œ

jobs:
  trigger-main-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Main Repository Workflow
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // [TeamBlog]ë¡œ ì‹œì‘í•˜ëŠ” íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
            const changedFiles = context.payload.commits?.[0]?.added || [];
            const hasTeamBlogFile = changedFiles.some(file => file.startsWith('[TeamBlog]'));
            
            if (hasTeamBlogFile || changedFiles.length > 0) {
              console.log('ğŸ“ Wiki íŒŒì¼ ë³€ê²½ ê°ì§€:', changedFiles);
              
              const { data } = await github.rest.actions.createWorkflowDispatch({
                owner: '100-hours-a-week',
                repo: '9-team-Devths-WIKI',
                workflow_id: 'sync-wiki-to-supabase.yml',
                ref: 'main'
              });
              
              console.log('âœ… Main repository workflow triggered');
            } else {
              console.log('â­ï¸  [TeamBlog] íŒŒì¼ ë³€ê²½ ì—†ìŒ, ìŠ¤í‚µ');
            }
